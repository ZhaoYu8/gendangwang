(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Plan"],{"3d02":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=this,a=t.$createElement,r=t._self._c||a;return r("div",{staticClass:"plan box p-10"},[r("Panel",{attrs:{arr:t.arr},on:{change:t.handleChange}},[r("el-col",{attrs:{span:24}},[r("el-form-item",{staticClass:"f-r"},[r("el-button",{attrs:{type:"primary"},on:{click:t.moreDel}},[t._v("多选删除")]),r("el-button",{attrs:{type:"primary"},on:{click:t.special}},[t._v("特殊计划单")]),r("el-button",{attrs:{type:"primary"},on:{click:t.copyAdd}},[t._v("复制新建")]),r("el-button",{attrs:{type:"primary"},on:{click:function(){e.checkArr=[],e.query()}}},[t._v("查询")]),r("el-button",{attrs:{type:"warning"},on:{click:function(e){t.dialog1=!0}}},[t._v("新增")])],1)],1)],1),r("div",{staticClass:"pt-10 table"},[r("el-table",{ref:"firstTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""},on:{select:t.selected,"select-all":t.selectedAll}},[r("el-table-column",{attrs:{type:"selection",width:"50",align:"center","header-align":"center"}}),r("el-table-column",{attrs:{label:"操作",width:"50",align:"center","header-align":"center"},scopedSlots:t._u([{key:"default",fn:function(e){return r("div",{staticStyle:{display:"flex","justify-content":"space-around"}},[r("el-link",{attrs:{underline:!1,type:"danger"},on:{click:function(a){return t.del(e)}}},[t._v("删除")])],1)}}])}),t._l(t.tableHeader,(function(e,a){return r("el-table-column",{key:e.label+a,attrs:{"header-align":"center",label:e.label,width:e.width},scopedSlots:t._u([{key:"default",fn:function(a){return["date"===e.type?r("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,type:"date",placeholder:e.placeholder||"请选择"},on:{change:function(r){return t.tableChange(a.row,e)}},model:{value:a.row[e.id],callback:function(r){t.$set(a.row,e.id,r)},expression:"scope.row[item.id]"}}):"input"===e.type?r("el-input",{directives:[{name:"focus",rawName:"v-focus"}],on:{change:function(r){return t.tableChange(a.row,e)}},model:{value:a.row[e.id],callback:function(r){t.$set(a.row,e.id,r)},expression:"scope.row[item.id]"}}):r("div",[t._v(t._s(a.row[e.id]))])]}}],null,!0)})}))],2)],1),r("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"total, prev, pager, next, jumper",total:t.paginate_meta.total_count,"current-page":t.currentPage},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e},"current-change":t.currentChange}}),r("Dialog1",{attrs:{dialogVisibl:t.dialog1},on:{cancel:t.cancel}}),r("Dialog2",{attrs:{dialogVisibl:t.dialog2,selectArr:t.checkArr},on:{cancel:t.cancel}}),r("Dialog3",{attrs:{dialogVisibl:t.dialog3},on:{cancel:t.cancel}})],1)},n=[],i=(a("4de4"),a("c740"),a("caad"),a("d81d"),a("a434"),a("a9e3"),a("2532"),a("5530")),l=(a("96cf"),a("1da1")),c=a("2909"),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"dialog",attrs:{title:"新增工作计划",visible:e.dialogVisible,width:"85%",top:"5vh"},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){return e.cancel(!1)}}},[a("Panel",{attrs:{arr:e.arr},on:{change:e.onChange}}),a("div",{staticClass:"pt-10"},[a("el-table",{ref:"dialog1Table",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",height:"400"},on:{select:e.selected,"select-all":e.selectedAll}},[a("el-table-column",{attrs:{type:"selection",width:"50",align:"center","header-align":"center"}}),a("el-table-column",{attrs:{label:"产品名称",align:"center",prop:"product_name","header-align":"center","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{label:"产品编号",align:"center",prop:"product_serial","header-align":"center"}}),a("el-table-column",{attrs:{label:"所属客户",align:"center",prop:"customer_name","header-align":"center"}}),a("el-table-column",{attrs:{label:"订单编号",align:"center",prop:"order_serial","header-align":"center"}}),a("el-table-column",{attrs:{label:"订单数量",align:"center",prop:"order_quantity","header-align":"center"}}),a("el-table-column",{attrs:{label:"单价",align:"center",prop:"product_price","header-align":"center"}}),a("el-table-column",{attrs:{label:"总库存数量",align:"center",prop:"storage_quantity","header-align":"center"}})],1),a("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"total, prev, pager, next, jumper",total:e.total,"current-page":e.currentPage},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.currentChange}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",round:""},on:{click:e.onOk}},[e._v("提交计划")])],1)],1)},s=[],d=(a("b0c0"),{name:"Dialog1",props:{dialogVisibl:{type:Boolean,default:function(){return!1}}},data:function(){return{dialogVisible:!1,currentPage:1,total:1,tableData:[],arr:[{label:"日期",model:moment().format("YYYY-MM-DD"),placeholder:"",id:"delivery_date",type:"date",data:[]},{label:"班次",model:"",placeholder:"",id:"delivery_shifts",type:"select",data:[]},{label:"下单客户",model:"",placeholder:"",id:"customer_id",type:"page",data:[]},{label:"收货单位",model:"",placeholder:"",id:"receiving_unit"},{label:"路线",model:"",placeholder:"请输入路线",id:"delivery_route"},{label:"产品名称",model:"",placeholder:"请输入产品名称",id:"product_name",noHttp:!0},{label:"产品所属",model:"",placeholder:"",id:"abc",type:"page",data:[],noHttp:!0},{label:"特殊事宜",model:"",placeholder:"",id:"special_matter",type:"select",data:[{name:"是",id:"是"},{name:"否",id:"否"}]},{label:"交代说明",model:"",placeholder:"输入备注说明或需要交代的事项",id:"note",span:24}],checkArr:[]}},watch:{dialogVisibl:{handler:function(e){e&&(this.arr=this.$options.data().arr,this.dialogVisible=!0,this.arr[6].data=this.arr[2].data=this.$vuexData.x.customer,this.arr[2].model=this.$vuexData.x.customer[0].id,this.arr[3].model=this.$vuexData.x.customer[0].name,this.arr[1].data=[{name:"",id:""},{name:"早班",id:"早班"},{name:"中班",id:"中班"}],this.onChange(this.arr[2]),this.checkArr=[])},immediate:!0}},methods:{queryProduct:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;t.page=this.currentPage,this.$post("/delivery_plans/order_products",t).then((function(t){e.tableData=t.data.data,e.total=t.data.paginate_meta.total_count,e.reqeat(),"customer_id"===a.id&&(e.arr[4].model=t.data.delivery_route)}))},currentChange:function(e){this.commonQuery(this.arr[2],e)},onChange:function(e,t){if("customer_id"===e.id){var a=e.data.filter((function(t){return t.id===e.model}))[0];this.arr[3].model=a.name}this.commonQuery(e,t)},commonQuery:function(e,t){this.currentPage=t||1;var a=["customer_id","abc","product_name"],r={};if(a.includes(e.id)){this.arr.map((function(e){a.includes(e.id)&&""!==e.model&&(r[e.id]=e.model)}));var n={arr:[r.customer_id||0,r.abc||0],customer_ids:[],product_name:r.product_name};n.arr.map((function(e){e&&n.customer_ids.push(e)})),this.queryProduct(n,e)}},cancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("cancel",e),this.dialogVisible=!1},onOk:function(){var e=this;if(this.checkArr.length){var t={};this.arr.map((function(e){e.model&&!e.noHttp&&(t[e.id]=e.model)})),t.product_ids=this.checkArr.map((function(e){return e.id})),t.delivery_date=this.$common.format(t.delivery_date),this.$post("/delivery_plans/batch_create",t).then((function(t){e.$notify({title:"提示",message:"新增工作计划成功!",type:"success"}),e.cancel(!0)}))}else this.$notify({title:"警告",message:"最少选择一条产品数据!",type:"warning"})},reqeat:function(){var e=this;this.$nextTick((function(){e.tableData.map((function(t){e.checkArr.map((function(e){return e.id})).includes(t.id)&&e.$refs.dialog1Table.toggleRowSelection(t)}))}))},selected:function(e,t){if(e.filter((function(e){return e.id===t.id})).length)this.checkArr.push({name:t.product_name,id:t.id});else{var a=this.checkArr.findIndex((function(e){return e.id===t.id}));this.checkArr.splice(a,1)}},selectedAll:function(e){var t=this;this.tableData.map((function(e){var a=t.checkArr.findIndex((function(t){return t.id===e.id}));a>-1&&t.checkArr.splice(a,1)})),e.length&&e.map((function(e){t.checkArr.push({name:e.product_name,id:e.id})}))}}}),u=d,h=a("0c7c"),p=Object(h["a"])(u,o,s,!1,null,"4fb43249",null),m=p.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"dialogthree dialog",attrs:{title:"复制新建",visible:e.dialogVisible,width:"96%",top:"5vh"},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){return e.cancel(!1)}}},[a("div",{staticClass:"pt-10 "},[a("el-table",{ref:"dialog2Table",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",height:"600"},on:{select:e.selected}},[a("el-table-column",{attrs:{type:"selection",width:"50",align:"center","header-align":"center"}}),e._l(e.tableHeader,(function(t,r){return a("el-table-column",{key:t.label+r,attrs:{label:t.label,width:t.width,"header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(r){return["date"===t.type?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,type:"date",placeholder:t.placeholder||"请选择"},model:{value:r.row[t.id],callback:function(a){e.$set(r.row,t.id,a)},expression:"scope.row[item.id]"}}):a("div",[e._v(e._s(r.row[t.id]))])]}}],null,!0)})}))],2),a("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"total, prev, pager, next, jumper",total:e.total,"current-page":e.currentPage1},on:{"update:currentPage":function(t){e.currentPage1=t},"update:current-page":function(t){e.currentPage1=t},"current-change":e.currentChange}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",round:""},on:{click:e.onOk}},[e._v("提交计划")])],1)])},f=[],b=(a("fb6a"),{name:"Dialog2",props:{dialogVisibl:{type:Boolean,default:function(){return!1}},selectArr:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,currentPage1:1,total:1,tableData:[],checkArr:[]}},computed:{tableHeader:function(){var e=Object(c["a"])(this.$common.tableHeader);return e.splice(7,0,{label:"单价",id:"product_price",type:"input",width:100}),e}},watch:{dialogVisibl:function(e){var t=this;e&&(this.dialogVisible=!0,this.currentPage1=1,this.checkArr=JSON.parse(JSON.stringify(this.selectArr)),this.tableData=this.checkArr.slice(10*(this.currentPage1-1),10*(this.currentPage1-1)+10),this.total=this.checkArr.length,this.$nextTick((function(){t.$refs.dialog2Table.toggleAllSelection()})))}},methods:{currentChange:function(e){this.currentPage1=e;var t=this.selectArr;this.tableData=t.slice(10*(this.currentPage1-1),10*(this.currentPage1-1)+10),this.reqeat()},cancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("cancel",e),this.dialogVisible=!1},onOk:function(){var e=this;if(this.checkArr.length){var t=this.checkArr.map((function(t){return{delivery_product_id:t.delivery_product_id,delivery_date:e.$common.format(t.delivery_date)}}));this.$post("/delivery_plans/clone_plans",{clone_objects:t}).then((function(t){e.$notify({title:"提示",message:"新增工作计划成功!",type:"success"}),e.cancel(!0)}))}else this.$notify({title:"警告",message:"最少选择一条产品数据!",type:"warning"})},reqeat:function(){var e=this;this.$nextTick((function(){e.tableData.map((function(t){e.checkArr.map((function(e){return e.delivery_product_id})).includes(t.delivery_product_id)&&e.$refs.dialog2Table.toggleRowSelection(t)}))}))},selected:function(e,t){if(e.filter((function(e){return e.delivery_product_id===t.delivery_product_id})).length)this.checkArr.push(t);else{var a=this.checkArr.findIndex((function(e){return e.delivery_product_id===t.delivery_product_id}));this.checkArr.splice(a,1)}}}}),v=b,y=Object(h["a"])(v,g,f,!1,null,"2df1106b",null),_=y.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"dialog",attrs:{title:"新增特殊计划",visible:e.dialogVisible,width:"96%",top:"5vh"},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){return e.cancel(!1)}}},[a("Panel",{attrs:{arr:e.arr}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",round:""},on:{click:e.onOk}},[e._v("提交计划")])],1)],1)},w=[],$={name:"Dialog3",props:{dialogVisibl:{type:Boolean,default:function(){return!1}}},data:function(){return{dialogVisible:!1,arr:[{label:"日期",model:moment().format("YYYY-MM-DD"),placeholder:"",id:"delivery_date",type:"date",data:[]},{label:"班次",model:"",placeholder:"",id:"delivery_shifts",type:"select",data:[]},{label:"下单客户",model:"",placeholder:"",id:"customer_id",type:"page",data:[]},{label:"收货单位",model:"",placeholder:"",id:"receiving_unit"},{label:"路线",model:"",placeholder:"请输入路线",id:"delivery_route"},{label:"产品名称",model:"",placeholder:"请输入产品名称",id:"product_name",noHttp:!0},{label:"产品所属",model:"",placeholder:"",id:"abc",type:"page",data:[],noHttp:!0},{label:"特殊事宜",model:"",placeholder:"",id:"special_matter",type:"select",data:[{name:"是",id:"是"},{name:"否",id:"否"}]},{label:"交代说明",model:"",placeholder:"输入备注说明或需要交代的事项",id:"note",span:24}]}},watch:{dialogVisibl:function(e){e&&(this.dialogVisible=!0,this.arr[6].data=this.arr[2].data=this.$vuexData.x.customer,this.arr[2].model=this.$vuexData.x.customer[0].id,this.arr[1].data=[{name:"",id:""},{name:"早班",id:"早班"},{name:"中班",id:"中班"}])}},methods:{cancel:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("cancel",e),this.dialogVisible=!1},onOk:function(){var e=this,t={};this.arr.map((function(e){e.model&&!e.noHttp&&(t[e.id]=e.model)})),t.product_ids=[],t.delivery_date=this.$common.format(t.delivery_date),this.$post("/delivery_plans/batch_create",t).then((function(t){e.$notify({title:"提示",message:"新增特殊计划成功!",type:"success"}),e.cancel(!0)}))}}},x=$,A=Object(h["a"])(x,k,w,!1,null,"5c114592",null),D=A.exports,P={name:"Plan",props:{},components:{Dialog1:m,Dialog2:_,Dialog3:D},data:function(){return{dialog1:!1,dialog2:!1,dialog3:!1,paginate_meta:{},arr:[{label:"下单客户：",model:"",placeholder:"",type:"page",data:[],id:"customer_id"},{label:"收货单位：",model:"",placeholder:"",data:[],id:"receiving_unit"},{label:"产品名称：",model:"",placeholder:"",id:"product_name"}],currentPage:1,tableData:[],checkArr:[]}},watch:{},computed:{tableHeader:function(){var e=Object(c["a"])(this.$common.tableHeader);return e.splice(7,0,{label:"单价",id:"product_price",type:"input",width:100}),e}},methods:{handleChange:function(e){"product_name"===e.id&&this.query()},selected:function(e,t){if(e.filter((function(e){return e.id===t.id})).length)this.checkArr.push(t);else{var a=this.checkArr.findIndex((function(e){return e.id===t.id}));this.checkArr.splice(a,1)}},selectedAll:function(e){var t=this;this.tableData.map((function(e){var a=t.checkArr.findIndex((function(t){return t.id===e.id}));a>-1&&t.checkArr.splice(a,1)})),e.length&&e.map((function(e){t.checkArr.push(e)}))},currentChange:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.currentPage=e,a.next=3,t.query();case 3:t.$nextTick((function(){t.tableData.map((function(e){t.checkArr.map((function(e){return e.delivery_product_id})).includes(e.delivery_product_id)&&t.$refs.firstTable.toggleRowSelection(e)}))}));case 4:case"end":return a.stop()}}),a)})))()},cancel:function(e){var t=this;e&&(this.checkArr=[],this.currentPage=1,this.query(),this.$vuexFn.getCommon().then((function(){t.$bus.$emit("user")}))),this.dialog3=this.dialog2=this.dialog1=!1},query:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=Object(i["a"])(Object(i["a"])({},e.$common.querySql.call(e,e.arr)),{page:e.currentPage}),t.next=3,e.$post("/delivery_plans/list_plan",a).then((function(t){var a=t.data.data;a.map((function(e){parseInt(e.delivery_number)||Number(e.sparetime_percent)?e.sparetime=Math.ceil(parseInt(e.delivery_number)*Number(e.sparetime_percent)/100):e.sparetime=0})),e.tableData=[],e.$nextTick((function(){e.tableData=a})),e.paginate_meta=t.data.paginate_meta}));case 3:case"end":return t.stop()}}),t)})))()},del:function(e){var t=this;return Object(l["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$common.del.call(t,e);case 2:r=a.sent,n=t,r&&setTimeout((function(){n.query()}),300);case 5:case"end":return a.stop()}}),a)})))()},moreDel:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.checkArr,a.length){t.next=4;break}return e.$notify({title:"警告",message:"你必须选择数据，才能进行多选删除!",type:"warning"}),t.abrupt("return");case 4:e.$confirm("确定删除么？本次删除 ".concat(a.length," 条数据！"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$post("/delivery_plans/batch_delete",{delivery_product_ids:a.map((function(e){return e.delivery_product_id}))}).then((function(){e.$message({type:"success",message:"删除成功!"});var t=e;setTimeout((function(){t.query()}),300)}))}));case 5:case"end":return t.stop()}}),t)})))()},tableChange:function(e,t){this.$common.tableChange.call(this,e,t)},summary:function(){this.$notify({title:"警告",message:"等接口!",type:"warning"})},copyAdd:function(){this.checkArr.length?this.dialog2=!0:this.$notify({title:"警告",message:"最少选择一条数据!",type:"warning"})},special:function(){this.dialog3=!0}},mounted:function(){var e=this;this.arr[0].data=this.$vuexData.x.customer,this.$bus.$on("user",(function(){e.arr[0].data=e.$vuexData.x.customer})),this.query()}},C=P,V=Object(h["a"])(C,r,n,!1,null,"782767e6",null);t["default"]=V.exports},a434:function(e,t,a){"use strict";var r=a("23e7"),n=a("23cb"),i=a("a691"),l=a("50c4"),c=a("7b0b"),o=a("65f0"),s=a("8418"),d=a("1dde"),u=a("ae40"),h=d("splice"),p=u("splice",{ACCESSORS:!0,0:0,1:2}),m=Math.max,g=Math.min,f=9007199254740991,b="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!h||!p},{splice:function(e,t){var a,r,d,u,h,p,v=c(this),y=l(v.length),_=n(e,y),k=arguments.length;if(0===k?a=r=0:1===k?(a=0,r=y-_):(a=k-2,r=g(m(i(t),0),y-_)),y+a-r>f)throw TypeError(b);for(d=o(v,r),u=0;u<r;u++)h=_+u,h in v&&s(d,u,v[h]);if(d.length=r,a<r){for(u=_;u<y-r;u++)h=u+r,p=u+a,h in v?v[p]=v[h]:delete v[p];for(u=y;u>y-r+a;u--)delete v[u-1]}else if(a>r)for(u=y-r;u>_;u--)h=u+r-1,p=u+a-1,h in v?v[p]=v[h]:delete v[p];for(u=0;u<a;u++)v[u+_]=arguments[u+2];return v.length=y-r+a,d}})}}]);